<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Waybill Editor</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React + ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- html2pdf.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <style>
    body { margin: 0; background: #f3f4f6; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState } = React;

    function WaybillEditor() {
      // Initialize form data once
      const getInitialFormData = () => {
        const now = new Date();
        const months = ['01','02','03','04','05','06','07','08','09','10','11','12'];
        const day = now.getDate();
        const month = months[now.getMonth()];
        const year = now.getFullYear();

        const hours = now.getHours();
        const minutes = now.getMinutes();
        const origenHora = `${String(hours).padStart(2,'0')}:${String(minutes).padStart(2,'0')}`;

        // Destination = origin + 30 minutes
        const destinoDate = new Date(now.getTime() + 30 * 60 * 1000);
        const destinoHora = `${String(destinoDate.getHours()).padStart(2,'0')}:${String(destinoDate.getMinutes()).padStart(2,'0')}`;

        return {
          proveedorNombre: 'KIPLAX NEGOCIOS S,L',
          proveedorNIF: 'ESB67106112',
          proveedorMatricula: '0793-LTC',
          clienteNombre: 'Arnau Rodriguez Rodriguez',
          clienteID: 'Pedir al pasajero',
          fechaLugar: `BARCELONA, ${day} del ${month} de ${year} ${origenHora}`,
          origenDireccion: 'Carrer Narcís de Monturiol 08192 Sant Quirze del Vallès, ES',
          origenHora,
          destinoDireccion: '08224 Terrassa, ES',
          destinoHora,
          precio: ''
        };
      };

      const [formData, setFormData] = useState(getInitialFormData());

      const handleChange = (field, value) => {
        setFormData(prev => ({
          ...prev,
          [field]: value
        }));
      };

      // Generate PDF function
      const generatePDF = () => {
        const element = document.getElementById("pdf-content");
        const opt = {
          margin: 0.5,
          filename: 'waybill.pdf',
          image: { type: 'jpeg', quality: 0.98 },
          html2canvas: { scale: 2 },
          jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
        };
        html2pdf().set(opt).from(element).save();
      };

      return (
        <div className="min-h-screen bg-gray-100 p-4">
          {/* Button */}
          <div className="flex justify-end mb-4">
            <button
              onClick={generatePDF}
              className="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
            >
              Exportar PDF
            </button>
          </div>

          {/* PDF content */}
          <div id="pdf-content" className="bg-white p-4 max-w-4xl mx-auto">
            {/* Header */}
            <div className="bg-black text-white p-4 flex items-center mb-4">
              <button className="mr-4 text-2xl">←</button>
              <h1 className="text-2xl font-bold">Waybill</h1>
            </div>

            <h2 className="text-3xl font-bold mb-4">CONTRATO</h2>

            <p className="text-sm text-gray-700 mb-6">
              En aquellos casos en los que la copia acreditativa del contrato contenga los mismos datos exigibles para la hoja de ruta, no será necesario cumplimentar esta (Art. 24 ORDEN FOM 36/2008)
            </p>

            {/* Provider Section */}
            <div className="bg-gray-100 mb-4 p-3 font-semibold border border-gray-300">Proveedor del servicio de transporte:</div>
            <div className="mb-4 p-3 border border-gray-300">
              <div className="grid grid-cols-3 gap-4 mb-2">
                <span className="font-semibold">Nombre:</span>
                <input
                  type="text"
                  value={formData.proveedorNombre}
                  onChange={(e) => handleChange('proveedorNombre', e.target.value)}
                  className="col-span-2 border-b border-gray-300 outline-none"
                />
              </div>
              <div className="grid grid-cols-3 gap-4 mb-2">
                <span className="font-semibold">NIF:</span>
                <input
                  type="text"
                  value={formData.proveedorNIF}
                  onChange={(e) => handleChange('proveedorNIF', e.target.value)}
                  className="col-span-2 border-b border-gray-300 outline-none"
                />
              </div>
              <div className="grid grid-cols-3 gap-4">
                <span className="font-semibold">Matrícula:</span>
                <input
                  type="text"
                  value={formData.proveedorMatricula}
                  onChange={(e) => handleChange('proveedorMatricula', e.target.value)}
                  className="col-span-2 border-b border-gray-300 outline-none"
                />
              </div>
            </div>

            {/* Client Section */}
            <div className="bg-gray-100 mb-4 p-3 font-semibold border border-gray-300">Cliente:</div>
            <div className="mb-4 p-3 border border-gray-300">
              <div className="grid grid-cols-3 gap-4 mb-2">
                <span className="font-semibold">Nombre:</span>
                <input
                  type="text"
                  value={formData.clienteNombre}
                  onChange={(e) => handleChange('clienteNombre', e.target.value)}
                  className="col-span-2 border-b border-gray-300 outline-none"
                />
              </div>
              <div className="grid grid-cols-3 gap-4">
                <span className="font-semibold">ID:</span>
                <input
                  type="text"
                  value={formData.clienteID}
                  onChange={(e) => handleChange('clienteID', e.target.value)}
                  className="col-span-2 border-b border-gray-300 outline-none"
                />
              </div>
            </div>

            {/* Price Section */}
            <div className="mb-4 p-3 border border-gray-300">
              <div className="grid grid-cols-3 gap-4">
                <span className="font-semibold">Precio:</span>
                <input
                  type="text"
                  value={formData.precio}
                  onChange={(e) => handleChange('precio', e.target.value)}
                  className="col-span-2 border-b border-gray-300 outline-none"
                  placeholder="0.00 €"
                />
              </div>
            </div>

            {/* Date / Place */}
            <div className="mb-4">
              <label className="block font-semibold mb-2">Fecha / lugar del contrato y servicio:</label>
              <input
                type="text"
                value={formData.fechaLugar}
                onChange={(e) => handleChange('fechaLugar', e.target.value)}
                className="w-full p-2 border border-gray-300 rounded outline-none"
              />
            </div>

            {/* Route Section */}
            <div className="mb-4 border border-gray-300">
              <div className="grid grid-cols-6 gap-2 p-3 bg-gray-100 font-semibold">
                <div className="col-span-1"></div>
                <div className="col-span-4">Lugar / Dirección</div>
                <div className="col-span-1">Hora</div>
              </div>

              <div className="p-4 space-y-4">
                <div className="grid grid-cols-6 gap-2 items-start">
                  <span className="font-semibold">Origen</span>
                  <input
                    type="text"
                    value={formData.origenDireccion}
                    onChange={(e) => handleChange('origenDireccion', e.target.value)}
                    className="col-span-4 border-b border-gray-300 outline-none"
                  />
                  <input
                    type="text"
                    value={formData.origenHora}
                    onChange={(e) => handleChange('origenHora', e.target.value)}
                    className="col-span-1 border-b border-gray-300 outline-none text-right"
                  />
                </div>

                <div className="grid grid-cols-6 gap-2 items-start">
                  <span className="font-semibold">Destino</span>
                  <input
                    type="text"
                    value={formData.destinoDireccion}
                    onChange={(e) => handleChange('destinoDireccion', e.target.value)}
                    className="col-span-4 border-b border-gray-300 outline-none"
                  />
                  <input
                    type="text"
                    value={formData.destinoHora}
                    onChange={(e) => handleChange('destinoHora', e.target.value)}
                    className="col-span-1 border-b border-gray-300 outline-none text-right"
                  />
                </div>
              </div>
            </div>
            

            {/* Footer */}
            <p className="text-sm text-gray-700">
              Condiciones de la contratación del servicio y su normativa en la página web de acceso a la solicitud, conforme a Ley 34/2002 de Servicios de la Sociedad de la Información y de Comercio Electrónico, habiendo sido aceptadas con la petición a través de la app. Si el recorrido cambia, el precio se ajustará en base a las tarifas establecidas.
            </p>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<WaybillEditor />);
  </script>
</body>
</html>
